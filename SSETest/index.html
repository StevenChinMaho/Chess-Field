<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>SSE Chatroom</title>
</head>
<body>
  <h1>簡易聊天室</h1>
  <div id="chat"></div>
  <form id="form">
    <input type="text" id="user" placeholder="你的名字">
    <input type="text" id="message" placeholder="輸入訊息">
    <button type="submit">送出</button>
  </form>

  <script>
    // 建立 SSE 連線
    const source = new EventSource("sse.php");
    source.addEventListener("message", function(event) {
      console.log(event);
      const data = JSON.parse(event.data);
      const chat = document.getElementById("chat");
      chat.innerHTML += `<p><b>${data.user}:</b> ${data.message}</p>`;
    });

    // 送出訊息
    document.getElementById("form").addEventListener("submit", function(e) {
      e.preventDefault();
      const user = document.getElementById("user").value;
      const message = document.getElementById("message").value;
      fetch("send.php", {
        method: "POST",
        headers: {"Content-Type": "application/x-www-form-urlencoded"},
        body: `user=${encodeURIComponent(user)}&message=${encodeURIComponent(message)}`
      });
      document.getElementById("message").value = "";
    });
  </script>
</body>
</html>
